---
title: "Swiftã®KeyPathã®ä½¿ã„ã©ã“ã‚"
emoji: "ğŸ”‘"
type: "tech"
topics:
  - "swift"
published: true
published_at: "2021-03-26 16:46"
---

# æ¦‚è¦
Swift4.2ã‹ã‚‰KeyPathã¨ã„ã†ã€å‹•çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹è¡¨ç¾ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
KeyPathã®ä½¿ã„ã©ã“ã‚ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã€å…·ä½“ä¾‹ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

# KeyPath

## åŸºæœ¬çš„ãªä½¿ã„æ–¹
å‰è¿°ã®ã¨ãŠã‚ŠKeyPathã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹è¡¨ç¾ã§ã™ã€‚
`\(ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥)`ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’å®£è¨€ã—ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```swift
struct Song {
    var title: String
    var artist: Artist
    var albumArtwork: UIImage
}

struct Artist {
    var name: String
}

let song = Song(title: "Let it Be", artist: Artist(name: "Beatles"), albumArtwork: UIImage(systemName: "square.and.arrow.up")!)
let keyPath: KeyPath<Song, String> = \.title
print(song[keyPath: keyPath]) // Let it Be
```

ãƒã‚¹ãƒˆã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`appending`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦KeyPathã‚’ä½œæˆã—ã¾ã™ã€‚
```swift
let song = Song(title: "Let it Be", artist: Artist(name: "Beatles"), albumArtwork: UIImage(systemName: "square.and.arrow.up")!)
let artistKeyPath: KeyPath<Song, Artist> = \.artist
let nameKeyPath: KeyPath<Artist, String> = \.name
let artistNameKeyPath = artistKeyPath.appending(path: nameKeyPath)
print(song[keyPath: artistNameKeyPath]) // Beatles
```
ã‚‚ã—ãã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
```swift
let song = Song(title: "Let it Be", artist: Artist(name: "Beatles"), albumArtwork: UIImage(systemName: "square.and.arrow.up")!)
let artistNameKeyPath: KeyPath<Song, String> = \Song.artist.name
print(song[keyPath: artistNameKeyPath]) // Beatles
```

## KeyPathã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ã‚‹
ã“ã“ã¾ã§KeyPathã‚’ç”¨ã„ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã«ã¤ã„ã¦è¦‹ã¦ãã¾ã—ãŸã€‚
ã§ã¯ã©ã†ã„ã†ã¨ãã«KeyPathã‚’ä½¿ã†ã¨ä¾¿åˆ©ãªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

é¡Œæã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ãƒ¼ãƒ–ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚
ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ã«ã¯ã€æ›²æƒ…å ±ã¨ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆæƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ujmpn5ht007kguxwkjh1fzp1tw5e)

:::message
ã“ã®é¡Œæã‚„ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ã€[The power of key paths in Swift](https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/)ã®æƒ…å ±ã‚’å¼•ç”¨ã•ã›ã¦ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚
:::

ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
```swift
struct Song {
    var title: String
    var artistName: String
    var albumArtwork: UIImage
}

struct Playlist {
    var name: String
    var authorName: String
    var artwork: String
}
```

é€šå¸¸[cellForRowAt](https://developer.apple.com/documentation/uikit/uitableviewdatasource/1614861-tableview)ã®ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚»ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«è¡¨ç¤ºã™ã‚‹å†…å®¹ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦ã€ä»£å…¥ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚
```swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = UITableViewCell(style: .subtitle, reuseIdentifier: "cell")
    if indexPath.section == 0 {
        let song = songs[indexPath.row]
	cell.textLabel?.text = song.title
	cell.detailTextLabel?.text = song.artistName
	cell.imageView?.image = song.albumArtwork
    } else {
        let playlist = playlists[indexPath.row]
	cell.textLabel?.text = playlist.name
	cell.detailTextLabel?.text = playlist.authorName
	cell.imageView?.image = playlist.artwork
    }
    return cell
}
```
ãŸã ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ãŸã„ãŒãŸã‚ã«ã€åŒã˜ã‚ˆã†ãªå‡¦ç†ã‚’é‡è¤‡ã—ã¦æ›¸ã‹ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚æ›´ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå¢—ãˆã€æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã‚‚å¢—ãˆã¦ã„ã‘ã°ç…©é›‘ãªã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ã“ã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«KeyPathã‚’ä½¿ã„ã¾ã™ã€‚

ã‚»ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹è²¬å‹™ã‚’æŒã¤æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚

```swift
struct CellConfigurator<Model> {
    let titleKeyPath: KeyPath<Model, String>
    let subtitleKeyPath: KeyPath<Model, String>
    let imageKeyPath: KeyPath<Model, UIImage>

    func configure(_ cell: UITableViewCell, for model: Model) {
        // Genericså‹ã®Modelã«å‹•çš„ã«å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ï¼
        cell.textLabel?.text = model[keyPath: titleKeyPath]
        cell.detailTextLabel?.text = model[keyPath: subtitleKeyPath]
        cell.imageView?.image = model[keyPath: imageKeyPath]
    }
}
```

ãã—ã¦ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã™ã‚Œã°ã€ã‚³ãƒ¼ãƒ‰è¡Œæ•°ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚Šã¾ã›ã‚“ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™ã ã‘ã«ãªã‚‹ã®ã§ã€ç…©é›‘ã•ã¯æ¶ˆãˆã‚¹ãƒƒã‚­ãƒªã—ãŸã‚³ãƒ¼ãƒ‰ã«ãªã‚‹ã‚ˆã†ã«æ€ã„ã¾ã™ã€‚
```swift
func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = UITableViewCell(style: .subtitle, reuseIdentifier: "cell")
    if indexPath.section == 0 {
        let songCellConfigurator = CellConfigurator<Song>(
	    titleKeyPath: \.title,
	    subtitleKeyPath: \.artistName,
	    imageKeyPath: \.albumArtwork
	 )
	 songCellConfigurator.configure(cell, for: songs[indexPath.row])
    } else {
        let playlistConfigurator = CellConfigurator<Playlist>(
	    titleKeyPath: \.name,
	    subtitleKeyPath: \.authorName,
	    imageKeyPath: \.artwork
	)
	playlistConfigurator.configure(cell, for: playlists[indexPath.row])
    }
    return cell
}
```

# ã¾ã¨ã‚
ã“ã®ã‚ˆã†ã«ã—ã¦KeyPathã‚’ä½¿ã†ã“ã¨ã§ã€å®Ÿè¡Œæ™‚ã«å‹•çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã¾ãŸKeyPathã‚’é€šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ã§ã€ç…©é›‘ãªã‚³ãƒ¼ãƒ‰ã‚„é‡è¤‡ã‚³ãƒ¼ãƒ‰ã‚’å›é¿ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## å‚è€ƒURL
- https://developer.apple.com/documentation/swift/swift_standard_library/key-path_expressions
- https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/
- https://dev.classmethod.jp/articles/swift_keypath1/
- https://qiita.com/shiz/items/b49251001a9ea54e4beb