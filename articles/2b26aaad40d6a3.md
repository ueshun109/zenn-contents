---
title: "SwiftUIã®çŠ¶æ…‹ç®¡ç†ã®åŸºç¤"
emoji: "ğŸ±"
type: "tech"
topics:
  - "ios"
  - "swiftui"
  - "çŠ¶æ…‹ç®¡ç†"
published: true
published_at: "2022-05-09 10:23"
---

# æ¦‚è¦
2019å¹´ã®WWDCã«ãŠã„ã¦SwiftUIãŒç™ºè¡¨ã•ã‚Œã¦ã‹ã‚‰ç´„3å¹´ãŒçµŒéã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«SwiftUIã‚’å°å…¥ã™ã‚‹æ–¹ã‚‚å¢—ãˆã¦ããŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ãã—ã¦SwiftUIãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ã«ãŠã„ã¦ã€**çŠ¶æ…‹ç®¡ç†ã‚’ã©ã†ã™ã‚‹ã‹**ã€ã¨ã„ã†å•é¡ŒãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚æœ¬ç¨¿ã§ã¯ç§ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦çŠ¶æ…‹ç®¡ç†ã«ã¤ã„ã¦ã©ã®ã‚ˆã†ã«è€ƒãˆã¦ã„ã‚‹ã‹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

# çŠ¶æ…‹ãƒ»çŠ¶æ…‹ç®¡ç†ã¨ã¯
SwiftUIã®ã‚ˆã†ãªå®£è¨€çš„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ãŠã„ã¦ã€å¤§ããªé–¢å¿ƒã”ã¨ã®ä¸€ã¤ã«**çŠ¶æ…‹ç®¡ç†**ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ã¾ãšã¯`çŠ¶æ…‹`ãƒ»`çŠ¶æ…‹ç®¡ç†`ã«ã¤ã„ã¦ã®å®šç¾©ã‚’ç¢ºèªã—ã€é‡è¦ãªæ¦‚å¿µã§ã‚ã‚‹**Single source of truth**ã«ã¤ã„ã¦ã‚‚è§¦ã‚Œã¦ã„ãã¾ã™ã€‚

## çŠ¶æ…‹
çŠ¶æ…‹ã¨ã¯ã€**UIã‚’(å†)æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã“ã¨**ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚
SwiftUIã®å ´åˆã€[Text](https://developer.apple.com/documentation/swiftui/text)ã®å¼•æ•°ã«Stringå‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ã§ã€ç”»é¢ã«ä»»æ„ã®æ–‡å­—åˆ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãã—ã¦Textã«æ¸¡ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ã€ç”»é¢ã®è¡¨ç¤ºã‚‚è‡ªå‹•ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚

çŠ¶æ…‹ã«ã¯å¤§ããåˆ†ã‘ã¦ï¼’ç¨®é¡ã‚ã‚Šã¾ã™ã€‚
ä¸€ã¤ã¯**Local State**ã€ã‚‚ã†ä¸€ã¤ã¯**Shared State**ã§ã™ã€‚
ã“ã‚Œã‚‰ã¯çŠ¶æ…‹ã®å‚ç…§ã‚¹ã‚³ãƒ¼ãƒ—ã®é•ã„ã§ã™ã€‚

### Local State
Local Stateã¯ã€è¤‡æ•°ã®ç”»é¢é–“ã§çŠ¶æ…‹ã‚’å…±æœ‰ã—ãªã„ãªã©ã€å‚ç…§ã‚¹ã‚³ãƒ¼ãƒ—ãŒé–‰ã˜ãŸçŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®`isPlaying`ã¯`PlayButton`ã®å†…éƒ¨ã§ã—ã‹å‚ç…§ã•ã‚Œãªã„ã®ã§ã€Local Stateã¨è¨€ãˆã¾ã™ã€‚

```swift: Local State
struct PlayButton: View {
  @State private var isPlaying: Bool = false

  var body: some View {
    Button(isPlaying ? "Pause" : "Play") {
      isPlaying.toggle()
    }
  }
}
```

### Shared State
Shared Stateã¨ã¯ã€è¤‡æ•°ã®ç”»é¢é–“ã§çŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚‹ãªã©ã€å‚ç…§ã‚¹ã‚³ãƒ¼ãƒ—ãŒåºƒã„çŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚ä»¥ä¸‹ã®`User`ã‚¢ã‚¯ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯è¤‡æ•°ç”»é¢ã§å…±æœ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€Shared Stateã¨è¨€ãˆã¾ã™ã€‚

```swift: Shared State
@MainActor
final class User: ObservableObject {
  @Published var isLogin = false
}

struct MyPage: View {
  @ObservedObject var user: User
  var body: some View {
    Button {
      user.isLogin.toggle()
    } label: {
      Text(user.isLogin ? "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ" : "ãƒ­ã‚°ã‚¤ãƒ³")
    }
  }
}

struct TopPage: View {
  @ObservedObject var user: User
  var body: some View {
    Text(user.isLogin ? "ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿" : "æœªãƒ­ã‚°ã‚¤ãƒ³")
  }
}
```

## çŠ¶æ…‹ç®¡ç†
çŠ¶æ…‹ç®¡ç†ã¨ã¯ã€**çŠ¶æ…‹ã®æ•´åˆæ€§ãŒç ´ç¶»ã—ãªã„ã‚ˆã†ã«ç®¡ç†ã™ã‚‹ã“ã¨**ã§ã™ã€‚
ä¾‹ãˆã°æ—…é¤¨ã‚’äºˆç´„ã—ã¦äºˆç´„ä¸€è¦§ç”»é¢ã§ã¯äºˆç´„æ¸ˆã¿ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ãªã£ã¦ã„ã‚‹ã®ã«ã€äºˆç´„ç¢ºèªç”»é¢ã§ã¯äºˆç´„æ¸ˆã¿ã«ãªã£ã¦ã„ãªã„å ´åˆã€ã“ã‚Œã¯çŠ¶æ…‹ã®æ•´åˆæ€§ãŒå–ã‚Œã¦ãŠã‚‰ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å›°æƒ‘ã•ã›ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå•é¡Œã‚’èµ·ã“ã•ãªã„ãŸã‚ã«çŠ¶æ…‹ç®¡ç†ã¯é‡è¦ã¨ãªã£ã¦ãã¾ã™ã€‚

## Single source of truth
ã“ã“ã¾ã§çŠ¶æ…‹ãƒ»çŠ¶æ…‹ç®¡ç†ã«ã¤ã„ã¦è¦‹ã¦ãã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã¯ **ä¿¡é ¼ã§ãã‚‹å”¯ä¸€ã®æƒ…å ±æº (Single source of truth: SSOT)** ã¨ã„ã†æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ç†è«–ã®åŸå‰‡ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚
SSOTã¨ã¯ã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒï¼‘ç®‡æ‰€ã§ã®ã¿ä½œæˆã€ç·¨é›†ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã®åŸå‰‡ã«å¾“ã†ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿(çŠ¶æ…‹)ã®æ•´åˆæ€§ãŒç ´ç¶»ã›ãšã«ã€ãã‚Œã¯ä¿¡é ¼ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã«ãªã‚Šã¾ã™ã€‚

ã¤ã¾ã‚ŠçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ä¸Šã§ã€çŠ¶æ…‹ãŒSSOTã§ã‚ã‚‹ã‹ã©ã†ã‹æ„è­˜ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ãã—ã¦SSOTã«ãªã£ã¦ã„ã‚Œã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–“é•ã£ãŸæƒ…å ±ã‚’ä¼ãˆã¦ã—ã¾ã†å¯èƒ½æ€§ã‚’ä½ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# Property Wrapper
SwiftUIã¯çŠ¶æ…‹ç®¡ç†ã«é–¢ã™ã‚‹æ©Ÿèƒ½ã‚’ã„ãã¤ã‹æä¾›ã—ã¦ãŠã‚Šã€å®Ÿè£…ã™ã‚‹ä¸Šã§ãã‚Œã‚‰ã‚’ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ãŒé‡è¦ã«ãªã£ã¦ãã¾ã™ã€‚ã¾ãšã¯`@State`ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚

## @State
SwiftUIã§åŸºæœ¬çš„ãªProperty Wrapperã§ã™ã€‚
`@State`ã§ãƒãƒ¼ã‚¯ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€**ä¿¡é ¼ã§ãã‚‹æƒ…å ±æº**ã«ãªã‚Šã¾ã™ã€‚
`@State`ã§ãƒãƒ¼ã‚¯ã™ã‚‹ã¨SwiftUIãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç®¡ç†ã‚’å¼•ãç¶™ãã€å€¤ã‚’èª­ã¿æ›¸ãã™ã‚‹æ‰‹æ®µã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚ãªã®ã§`@State`ã§ãƒãƒ¼ã‚¯ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯å€¤è‡ªèº«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‚ç…§ã—ãŸéš›ã¯`wrappedValue`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ãŒè¿”ã•ã‚Œã¾ã™ã€‚

:::message
Property Wrapperã§ãƒãƒ¼ã‚¯ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹ã©ã†ã‹ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã¯é‡è¦ã§ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹æ„è­˜ã—ã¦ã„ãªã„ã¨ã€ä¸æ•´åˆãŒç°¡å˜ã«ç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

```swift
struct ContentView: View {
  @State private var text: String = "placeholder"
  var body: some View {
    VStack {
      TextField("placeholder", text: $text)
        .multilineTextAlignment(.center)
      SampleView(text: text)
    }
    .padding()
  }
}

struct SampleView: View {
  // Source of Truthã§ã‚ã‚‹ã‹ã©ã†ã‹æ„è­˜ã—ã¦ã„ãªã„ã®ã§ã€`@State`ã§ãƒãƒ¼ã‚¯ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã€‚
  @State var text: String

  var body: some View {
    Text(text)
      .foregroundColor(.green)
  }
}
```

ã“ã®å ´åˆTextFieldã§æ–‡å­—åˆ—ã‚’ç·¨é›†ã—ã¦ã‚‚ã€SampleViewã®æ–‡å­—åˆ—ã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚

![](https://storage.googleapis.com/zenn-user-upload/7ee6a7bdaa29-20220421.gif =150x)

ãªãœãªã‚‰`@State`ã§ãƒãƒ¼ã‚¯ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ãªã£ã¦ã—ã¾ã†ãŸã‚ã§ã™ã€‚
SampleViewã®textãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ãŸã‚ã€ContentViewã®textãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã¯åˆ¥ç‰©ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚TextFieldã®ç·¨é›†ã«å¿œã˜ã¦SampleViewã®æ–‡å­—åˆ—ã‚‚å¤‰æ›´ã—ãŸã„å ´åˆã€ContentViewã®textãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ã—ã€ãã®çŠ¶æ…‹ã‚’SampleViewãŒå‚ç…§ã™ã‚‹ã€ã¨ã„ã†è€ƒãˆæ–¹ã‚’ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã¨ContentViewã®textãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ãªã‚Šã¾ã™ã€‚ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹ã©ã†ã‹ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã¯`@State`ã«é™ã£ãŸè©±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```diff swift
struct SampleView: View {
-  @State var text: String
+  let text: String

  var body: some View {
    Text(text)
      .foregroundColor(.blue)
  }
}
```

ãã—ã¦TextFieledã§æ–‡å­—åˆ—ã‚’ç·¨é›†ã™ã‚‹ã¨ã€SampleViewã®æ–‡å­—åˆ—ã‚‚å¤‰æ›´ã•ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ae2d242317c8-20220421.gif =150x)
:::

## ObservableObject
`@State`ã¨åŒæ§˜ã«çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã¨ã—ã¦ã€[ObservableObject](https://developer.apple.com/documentation/combine/observableobject)ãŒã‚ã‚Šã¾ã™ã€‚
`@State`ã¨ç•°ãªã‚‹ç‚¹ã¨ã—ã¦ã€`ObservableObject`ã¯protocolã§ã‚ã‚Šã€å‚ç…§å‹ã®ã¿æº–æ‹ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`ObservableObject`ã¯ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‚’ä½œæˆã—ã€å¤‰æ›´ã«ã©ã†å¯¾å¿œã™ã‚‹ã‹SwiftUIã«æ•™ãˆã¦ã„ã¾ã™ã€‚

ã¾ãŸã‚‚ã†ä¸€ã¤é‡è¦ãªã®ãŒ`@Published`ã§ã™ã€‚
`@Published`ã¯[Publisher](https://developer.apple.com/documentation/combine/published/publisher)ã‚’å…¬é–‹ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦³æ¸¬å¯èƒ½ã«ã™ã‚‹Property Wrapperã§ã™ã€‚
`View`ã¨ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸã«ã¤ã„ã¦ã¯SwiftUIãŒè¡Œã£ã¦ã„ã‚‹ã®ã§ã€å®Ÿè£…è€…ã¯æ°—ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
SwiftUIã¯å¤‰æ›´ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹æ™‚ã‚’çŸ¥ã‚Šã€ã™ã¹ã¦ã®å¤‰æ›´ã‚’ï¼‘å›ã®æ›´æ–°ã«ã¾ã¨ã‚ã¾ã™ã€‚

SwiftUIã«ã¯`ObservableObject`ã¸ã®ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€Viewã§ä½¿ç”¨ã§ãã‚‹Property WrapperãŒ3ã¤ã‚ã‚Šã¾ã™ã€‚
- [@ObservedObject](https://developer.apple.com/documentation/swiftui/observedobject)
- [@StateObject](https://developer.apple.com/documentation/swiftui/stateobject)
- [@EnvironmentObject](https://developer.apple.com/documentation/swiftui/environmentobject)

## @ObservedObject
`@ObservedObject`ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒãƒ¼ã‚¯ã™ã‚‹ã¨ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´ã‚’ç›£è¦–ã™ã‚‹ã‚ˆã†SwiftUIã«é€šçŸ¥ã—ã¾ã™ã€‚ã¾ãŸãã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ãªã‚Šã€`View`ãŒUIã®æ§‹ç¯‰ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ç‰¹å¾´ã¨ã—ã¦`@ObservedObject`ã¯æä¾›ã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ‰€æœ‰æ¨©ã‚’å–å¾—ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ç®¡ç†è²¬ä»»ã¯å®Ÿè£…è€…ã«ã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚è¤‡æ•°`View`ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã—ãŸã„å ´åˆã«æœ‰åŠ¹ã§ã™ã€‚

ã—ã‹ã—`@ObservedObject`ã¯`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ä»˜ã‹ãªã„ãŸã‚ã€`View`ãŒç ´æ£„ã•ã‚ŒãŸã‚ã¨ã‚‚ç”Ÿå­˜ã—ç¶šã‘ã¦ã—ã¾ã„ã¾ã™ã€‚ã‚ã‚‹ãƒ“ãƒ¥ãƒ¼ã®ç”Ÿå­˜æœŸé–“ã®ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿã‹ã—ãŸã„ã¨ã„ã†ã‚ˆã†ãªã“ã¨ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

## @StateObject
ãã“ã§`@StateObject`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`@StateObject`ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒãƒ¼ã‚¯ã™ã‚‹ã¨ãã¯åˆæœŸå€¤ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã™ã‚‹ã¨SwiftUIã¯åˆå›ã«bodyã‚’å®Ÿè¡Œã™ã‚‹ç›´å‰ã«ãã®å€¤ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€Viewã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å­˜ç¶šã•ã›ã¾ã™ã€‚ãã—ã¦`@StateObject`ã§ãƒãƒ¼ã‚¯ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ãªã‚Šã¾ã™ã€‚
`View`ãŒä¸è¦ã«ãªã‚‹ã¨ã€SwiftUIã¯`@StateObject`ã§ãƒãƒ¼ã‚¯ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã™ã€‚ã“ã®ç‰¹æ€§ã‚’ç”Ÿã‹ã—ã¦ãƒ«ãƒ¼ãƒˆã®`View`ã§`@StateObject`ã§ãƒãƒ¼ã‚¯ã™ã‚‹ã¨ã€ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚¢ãƒ—ãƒªã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ãã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

:::message
[initializer](https://developer.apple.com/documentation/swiftui/stateobject/init(wrappedvalue:))ã§åˆæœŸåŒ–ã™ã‚‹ã®ã¯ã ã‚ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚ç›´æ¥å‘¼ã¶ãªã¨æ›¸ã„ã¦ã‚ã‚Šã€è‡ªåˆ†ã®å ´åˆã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè§£æ”¾ã•ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã®è²¬å‹™ã¯SwiftUIã«ã¾ã‹ã›ã¦ãŠãã®ãŒè‰¯ã•ãã†ã§ã™ã€‚
:::

## @EnvironmentObject
SwiftUIã§ã¯`View`ãŒéå¸¸ã«ä½è² è·ãªã®ã§ã€ç†è§£ã—ã‚„ã™ãå†åˆ©ç”¨ã—ã‚„ã™ã„å°ã•ãª`View`ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¦ã„ã¾ã™ã€‚ãŸã ãã†ãªã‚‹ã¨éšå±¤ãŒæ·±ããªã‚Šã€`@ObservableObject`ã‚’é›¢ã‚ŒãŸã‚µãƒ–ãƒ“ãƒ¥ãƒ¼ã«æ¸¡ã™ã®ãŒé¢å€’ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã®ãŒ`@EnvironmentObject`ã§ã™ã€‚

|@EnvironmentObjectã‚’ä½¿ã‚ãªã„å ´åˆ|@EnvironmentObjectã‚’ä½¿ã†å ´åˆ|
|:--:|:--:|
|![](https://storage.googleapis.com/zenn-user-upload/4af0b14413bb-20220507.png =300x)|![](https://storage.googleapis.com/zenn-user-upload/db0068299129-20220507.png =300x)|

ä¸Šè¨˜ã®ã‚ˆã†ã«`@EnvironmentObject`ã‚’ä½¿ã‚ãªã„å ´åˆã€ãƒ‡ãƒ¼ã‚¿ã‚’å¿…è¦ã¨ã—ãªã„Viewã«ã‚‚æ¸¡ã™ã“ã¨ã¯é¢å€’ã§ã‚ã‚Šã€å¤šãã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿã‚“ã§ã—ã¾ã„ã¾ã™ã€‚

`ObservableObject`ã‚’æ³¨å…¥ã—ãŸã„è¦ªãƒ“ãƒ¥ãƒ¼ã§`environmentObject`Modifierã‚’ä½¿ç”¨ã—ã€
ç‰¹å®šã®ObservableObjectã‚’å‚ç…§ã—ãŸã„ã™ã¹ã¦ã®Viewã§`@EnvironmentObject`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ã™ã‚‹ã¨`@EnvironmentObject`ã§ãƒãƒ¼ã‚¯ã—ãŸç®‡æ‰€ã«ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã—å€¤ã‚’æ¸¡ã—ã¾ã™ã€‚ãã—ã¦`ObservableObject`ã«å¤‰æ›´ãŒç™ºç”Ÿã—ãŸå ´åˆã€å€¤ã®å¤‰æ›´ã‚’è¿½è·¡ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## @Stateã¨ObservableObjectã®ä½¿ã„åˆ†ã‘
ã¨ã‚‚ã«çŠ¶æ…‹ç®¡ç†ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã¨ã—ã¦ç´¹ä»‹ã—ã¾ã—ãŸãŒã€ã“ã‚Œã‚‰ã¯ã©ã®ã‚ˆã†ã«ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
ç§ãŒè€ƒãˆã‚‹ä¸€ã¤ã®æŒ‡é‡ã¨ã—ã¦**Local State**ã‹**Shared State**ã‹ã©ã†ã‹ã§ã™ã€‚
Local Stateã®ç®¡ç†ã«ã¯`@State`ã€Shared Stateã®ç®¡ç†ã«ã¯`ObservableObject`ã‚’ä½¿ã„ã¾ã™ã€‚

Local Stateã¯ä»–ã®`View`ã‹ã‚‰å‚ç…§ã•ã‚Œãªã„ãŸã‚ã€çŠ¶æ…‹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ã‘ãŸã„ã§ã™ã€‚`@State`ã§ãƒãƒ¼ã‚¯ã—ãŸçŠ¶æ…‹ã¯`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ããŸã‚é©ã—ã¦ã„ã¾ã™ã€‚

Shared Stateã¯è¤‡æ•°ã®`View`ãŒçŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã€çŠ¶æ…‹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¨ã¯åˆ‡ã‚Šé›¢ã—ãŸã„ã§ã™ã€‚`ObservableObject`ã«æº–æ‹ ã™ã‚‹ã‚‚ã®ã¯å‚ç…§å‹ã§ã‚ã‚‹ã“ã¨ãŒåˆ¶ç´„ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚å‚ç…§å‹ã¯ãƒ¡ãƒ¢ãƒªé ˜åŸŸã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ ¼ç´ã•ã‚Œã‚‹ãŸã‚ã€çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã—ã¦ã„ã‚‹ä»–ã®ç®‡æ‰€ã®çŠ¶æ…‹ã«ã‚‚å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚ãã®ãŸã‚`ObservableObject`ã§çŠ¶æ…‹ã‚’å…±æœ‰ã™ã‚‹ã«ã¯é©ã—ã¦ã„ã¾ã™ã€‚
```swift:å‚ç…§å‹ã®ä¾‹
class Foo {
  var value: Int = 0
}
var a = Foo()
var b = a
a.value = 2 // ã“ã®æ™‚b.valueã‚‚`2`ã«å¤‰æ›´ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
```

ãŸã ã“ã“ã§ä¸€ã¤çŸ›ç›¾ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚
ãã‚Œã¯çŠ¶æ…‹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ãã‹ã‚‰`@State`ã¯ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã«é©ã—ã¦ã„ã‚‹ã€ã¨ã„ã†ç‚¹ã§ã™ã€‚SwiftUIã¯å‰è¿°ã—ãŸ`@StateObject`ã¨ã„ã†Property Wrapperã‚‚æä¾›ã—ã¦ãŠã‚Šã€`@StateObject`ã§ãƒãƒ¼ã‚¯ã—ãŸ`ObservableObject`ã«æº–æ‹ ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚‚`View`ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ç´ã¥ãã¾ã™ã€‚

WWDC2020ã§ã¯ã€`ObservableObject`ã‚’ä½¿ã†ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ä»¥ä¸‹ï¼“ã¤ãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚
- ãƒ‡ãƒ¼ã‚¿ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ç®¡ç†
- å‰¯ä½œç”¨ã®å‡¦ç†
- æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ±åˆ

ãã“ã§`@State`ã¨`@StateObject`ã¯ã€
- `@State`ã¯ã€ç”»é¢ã®çŠ¶æ…‹ç®¡ç†
- `@StateObject`ã¯ã€å‰¯ä½œç”¨ã®å‡¦ç†ã‚’ä¼´ã†çŠ¶æ…‹ç®¡ç†

ã¨ã„ã†æ„Ÿã˜ã§ä½¿ã„åˆ†ã‘ã‚‹ã“ã¨ã‚’æ„è­˜ã—ã¦ã„ã¾ã™ã€‚

ä¸Šè¨˜ã‚’è¸ã¾ãˆã€ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ã†æ©Ÿèƒ½ã®ä½¿ã„åˆ†ã‘ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ddf9f5c40a0e-20220508.png =600x)

ã“ã“ã¾ã§çŠ¶æ…‹ã¨çŠ¶æ…‹ç®¡ç†ã€SwiftUIã®çŠ¶æ…‹ç®¡ç†ã«é–¢ã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦è¦‹ã¦ãã¾ã—ãŸã€‚ãŸã èª¬æ˜ã°ã‹ã‚Šã ã£ãŸã®ã§ã€æœ€å¾Œã«å…·ä½“çš„ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¸ã¾ãˆã¦ã©ã®ã‚ˆã†ã«çŠ¶æ…‹ç®¡ç†ã‚’ã—ã¦ã„ãã‹è¦‹ã¦ã„ãã¾ã™ã€‚

# Sample App
ä¾‹ã¨ã—ã¦ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã‚¢ãƒ—ãƒªã‚’æŒ™ã’ã€ä»¥ä¸‹ã®ã‚ˆã†ãªä»•æ§˜ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¾‹ã«ã—ã¦ã„ãã¾ã™ã€‚
- ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ãƒªãƒ¢ãƒ¼ãƒˆDBã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã‚’æƒ³å®šï¼ˆå®Ÿéš›ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ã„ã¾ã™ï¼‰
- ã‚¹ãƒ ãƒ¼ã‚¸ã®ä¸€è¦§ã‚’è¡¨ç¤º
- è©³ç´°ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
- ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ã§ãã‚‹
- ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã‚’ãŠæ°—ã«å…¥ã‚Šã§ãã‚‹
- ãŠæ°—ã«å…¥ã‚Šä¸€è¦§ã‚’è¡¨ç¤º

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚GitHubã«ç½®ã„ã¦ã‚ã‚Šã¾ã™ã€‚
https://github.com/ueshun109/SmoothieApp_iOS

## ãƒ‡ãƒ¼ã‚¿å–å¾—
ã¾ãšã¯ãƒ‡ãƒ¼ã‚¿ã®å–å¾—å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ãƒªãƒ¢ãƒ¼ãƒˆDBã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã‚’æƒ³å®šãŠã‚Šã€ã“ã‚Œã¯å‰¯ä½œç”¨ã‚’æŒã¤å‡¦ç†ã§ã™ã€‚ãã®ãŸã‚æœ€çµ‚çš„ã«`@StateObject`ã‚’ä½¿ã£ã¦ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã—ãŸã„ãŸã‚`ObservableObject`ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

```swift
@MainActor
final class SmoothieState: ObservableObject {
  @Published private(set) var smoothies: [Smoothie] = []
  let dataSource: SmoothieDataSource

  init(dataSource: SmoothieDataSource) {
    self.dataSource = dataSource
  }

  func fetchSmoothies() async {
    do {
      smoothies = try await dataSource.smoothies()
    } catch {
      // TODO: Handle error
    }
  }
}
```

:::message
å€‹äººçš„ã«`smoothies`ã¯æ›¸ãè¾¼ã¿ã®ã‚¹ã‚³ãƒ¼ãƒ—ã¯`private(set)`ã«ã—ã¦ãŠããŸã„ã§ã™ã€‚
`smoothies`ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ãƒªãƒ¢ãƒ¼ãƒˆDBã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Šã€ãã‚ŒãŒä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ãªã‚Šã¾ã™ã€‚`smoothies`ã®çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¦ã—ã¾ã†ã¨ãƒªãƒ¢ãƒ¼ãƒˆDBã§ç®¡ç†ã—ã¦ã„ã‚‹çŠ¶æ…‹ã¨æ•´åˆæ€§ãŒå–ã‚Œãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚ãã®ãŸã‚åŸºæœ¬çš„ã«ã¯`Binding`ãªã©ã§`smoothies`ã®çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒå°‘ãªããªã‚‹ã‚ˆã†ã«`private(set)`ã«ã—ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
:::

## ä¸€è¦§ç”»é¢
æ¬¡ã«ä¸€è¦§ç”»é¢ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
```swift
struct SmoothieListPage: View {
  @StateObject private var smoothieState: SmoothieState = .init(dataSource: .live)
  var body: some View {
    List {
      ForEach(smoothieState.smoothies) { smoothie in
        SmoothieRow(smoothie: smoothie)
      }
    }
    .navigationTitle("Menu")
    .task {
      await smoothieState.fetchSmoothies()
    }
  }
}

struct SmoothieRow: View {
  let smoothie: Smoothie

  var body: some View {
    HStack(alignment: .top) {
      smoothie.image
        .resizable()
        .aspectRatio(contentMode: .fill)
        .frame(width: 60, height: 60)
        .clipShapeForImage()

      VStack(alignment: .leading) {
        Text(smoothie.title)
          .font(.headline)

        Spacer()

        Text("Â¥\(smoothie.price)")
          .font(.callout)
          .foregroundStyle(.secondary)
      }
      .padding(.vertical, 8)
    }
  }
}
```
ã‚¹ãƒ ãƒ¼ã‚¸ã®ä¸€è¦§ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç”»é¢ã§ã—ã‹ä½¿ç”¨ã—ãªã„ãŸã‚ã€`@StateObject`ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

## è©³ç´°ç”»é¢ã¸ã®é·ç§»
```diff swift
struct SmoothieListPage: View {
+ @State private var selectedSmoothie: Smoothie.ID?
  @StateObject private var smoothieState: SmoothieState = .init(dataSource: .live)

  var body: some View {
    List {
      ForEach(smoothieState.smoothies) { smoothie in
+       NavigationLink(
+         tag: smoothie.id,
+         selection: $selectedSmoothie
+       ) {
+         // ä»Šå›ã¯ãƒ†ã‚­ã‚¹ãƒˆã ã‘è¡¨ç¤ºã™ã‚‹è©³ç´°ç”»é¢
+         Text(smoothie.title)
+       } label: {
+         SmoothieRow(smoothie: smoothie)
+       }
-       SmoothieRow(smoothie: smoothie)
      }
    }
    .navigationTitle("Menu")
    .task {
      await smoothieState.fetchSmoothies()
    }
  }
}
```

ã“ã“ã§ç”»é¢é·ç§»ã®ãŸã‚ã«é¸æŠã—ãŸã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã®IDã‚’ä¿æŒã™ã‚‹`selectedSmoothie`ã¨ã„ã†çŠ¶æ…‹ãŒç™»å ´ã—ã¾ã—ãŸã€‚é¸æŠã—ãŸã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã®çŠ¶æ…‹ã¯ã€ä¸€è¦§ç”»é¢ã®ã¿é–¢å¿ƒã®ã‚ã‚‹çŠ¶æ…‹ãªã®ã§Local Stateã§ã‚ã‚Šã€`@State`ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

## æ¤œç´¢ãƒãƒ¼ã®è¿½åŠ 
æ¬¡ã«ã‚¹ãƒ ãƒ¼ã‚¸ã®ä¸€è¦§ã‚’ãƒ•ã‚£ãƒ«ã‚¿ã™ã‚‹ãŸã‚ã«æ¤œç´¢ãƒãƒ¼ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```diff swift
struct SmoothieListPage: View {
  @State private var selectedSmoothie: Smoothie.ID?
+ @State private var filterKeyword: String = ""
  @StateObject private var smoothieState: SmoothieState = .init(dataSource: .live)

  var body: some View {
    List {
      ForEach(smoothieState.smoothies) { smoothie in
        NavigationLink(
          tag: smoothie.id,
          selection: $selectedSmoothie
        ) {
          Text(smoothie.title)
        } label: {
          SmoothieRow(smoothie: smoothie)
        }
      }
    }
+   .searchable(text: $filterKeyword)
    .navigationTitle("Menu")
    .task {
      await smoothieState.fetchSmoothies()
    }
  }
}
```
`searchable`Modifierã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®æ¤œç´¢ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ãã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›çŠ¶æ…‹ã‚’ã€`filterKeyword`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›çŠ¶æ…‹ã¯ã“ã®ç”»é¢ã§ã—ã‹å‚ç…§ã•ã‚Œãªã„ã€ã¤ã¾ã‚ŠLocal Stateãªã®ã§`@State`ã§ãƒãƒ¼ã‚¯ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ä¸€ã¤ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚ç¾çŠ¶`selectedSmoothie`ã¨`filterKeyword`ã¨ã„ã†ï¼’ã¤ã®ç”»é¢çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ã„ã¾ã™ãŒã€ä»Šå¾Œç®¡ç†ã™ã‚‹ç”»é¢çŠ¶æ…‹ãŒå¢—ãˆã¦ã„ã£ãŸå ´åˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¢—ãˆã¦ã„ãè¦‹é€šã—ãŒæ‚ªããªã£ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ç§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç”»é¢ã®çŠ¶æ…‹ã ã‘ã‚’ã¾ã¨ã‚ãŸæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ç”»é¢ã®çŠ¶æ…‹ãŒæ§‹é€ åŒ–ã•ã‚Œã‚‹ã®ã§å¯èª­æ€§ã‚‚ä¸ŠãŒã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

```diff swift
struct SmoothieListPage: View {
+ private struct UIState {
+   var selectedSmoothie: Smoothie.ID?
+   var filterKeyword: String = ""
+ }
- @State private var selectedSmoothie: Smoothie.ID?
- @State private var filterKeyword: String = ""
+ @State private var uiState = UIState()
  @StateObject private var smoothieState: SmoothieState = .init(dataSource: .live)

  var body: some View {
    List {
      ForEach(smoothieState.smoothies) { smoothie in
        NavigationLink(
          tag: smoothie.id,
-         selection: $selectedSmoothie
+         selection: $uiState.selectedSmoothie
        ) {
          Text(smoothie.title)
        } label: {
          SmoothieRow(smoothie: smoothie)
        }
      }
    }
-   .searchable(text: $filterKeyword)
+   .searchable(text: $uiState.filterKeyword)
    .navigationTitle("Menu")
    .task {
      await smoothieState.fetchSmoothies()
    }
  }
}
```
ã“ã®ã¾ã¾ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†ã®å®Ÿè£…ã‚‚ã—ã¦ã„ããŸã„ã§ã™ãŒã€ä¸€æ—¦ã‚¹ã‚­ãƒƒãƒ—ã—å¾Œã§å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

## è²©å£²çµ‚äº†æ—¥ã‚’è¡¨ç¤º
ã“ã“ã§è²©å£²çµ‚äº†æ—¥ã‚’è¡¨ç¤ºã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ã«æ°—ãŒä»˜ã„ãŸã®ã§ã€è²©å£²çµ‚äº†æ—¥ã®å®Ÿè£…ã‚’è¿½åŠ ã—ã¾ã™ã€‚
è²©å£²çµ‚äº†æ—¥ã¯`Date`å‹ã§å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ä¸€è¦§ç”»é¢ã§ã¯`yyyy/MM/dd`ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è¡¨ç¤ºã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚`Date`å‹ã‚’`yyyy/MM/dd`ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹å‡¦ç†ã¯**ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯**ã«è©²å½“ã™ã‚‹ã¨è€ƒãˆã¾ã™ã€‚
ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã¨ã¯ã€åå‰ã®é€šã‚Šç”»é¢ã«é–¢ä¿‚ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã¯ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
- ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã™ã‚‹(e.g. `Date`å‹ã‚’`String`å‹ã«å¤‰æ› etc.)
- æ—¢å­˜ã®çŠ¶æ…‹ã‹ã‚‰æ–°ã—ã„çŠ¶æ…‹ã‚’ç”Ÿæˆã™ã‚‹(e.g. æ–‡å­—è‰²ã«ã¤ã„ã¦ã€ã‚ã‚‹æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹å ´åˆã¯èµ¤è‰²ãã†ã§ãªã„å ´åˆã¯é’è‰²ã«ã™ã‚‹ etc.)
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã«å¿œã˜ã¦ã€æœŸå¾…ã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹

> ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã«å¿œã˜ã¦ã€æœŸå¾…ã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹

ã“ã‚Œã«ã¤ã„ã¦ã¯SwiftUIã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ(`Button` etc.)ãŒã‚«ãƒãƒ¼ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã§è€ƒãˆã‚‹å¿…è¦ã¯ãªã•ãã†ã§ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ã‚„æ–°ã—ã„çŠ¶æ…‹ã®ç”Ÿæˆã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å…±é€šç‚¹ã‚’æŒã£ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ãã‚Œã¯å…±ã«**ç´”ç²‹é–¢æ•°** ã§è¡¨ã™ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚
ä¾‹ãˆã°`Date`å‹ã‚’`String`å‹ã«å¤‰æ›ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚
```swift
enum SmoothieListPageLogic {
  static func toString(from date: Date) -> String {
    let formatter: DateFormatter = .slash
    return formatter.string(from: date)
  }
}
```

:::message
`enum`ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã®ã¯ã€åå‰ç©ºé–“ã‚’ä¸ãˆãŸã„ã ã‘ã§ã‚ã‚Šã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã›ãŸããªã„ä¸”ã¤çŠ¶æ…‹ã‚’æŒã¡ãŸããªã„ãŸã‚ã§ã™ã€‚
:::

ä¸Šè¨˜é–¢æ•°ã‚’SwiftUIã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§çŠ¶æ…‹ãŒåŠ å·¥ã•ã‚ŒãŸçŠ¶æ…‹ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚
```swift
Text("~ \(SmoothieListPageLogic.toString(from: smoothie.endDate))")
  .font(.callout)
  .foregroundStyle(.secondary)
```
ã¾ãŸ`smoothie`ã¨ã„ã†çŠ¶æ…‹ã«å¤‰æ›´ãŒã‚ã‚‹ã¨é–¢é€£ã™ã‚‹ç®‡æ‰€ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã®ã§ã€ãã®éš›ã«`toString`ã‚‚å†åº¦è©•ä¾¡ã•ã‚Œæ­£ã—ã„çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
ä»Šå›ã¯æ¤œç´¢ãƒãƒ¼ã«å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
ä»Šå›ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¯ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã¨ã¿ãªã—ã¦å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

```diff swift:SmoothieListPageLogic
enum SmoothieListPageLogic {
  static func toString(from date: Date) -> String {
    let formatter: DateFormatter = .slash
    return formatter.string(from: date)
  }

+ static func filter(with keyword: String, target: [Smoothie]) -> [Smoothie] {
+   guard !keyword.isEmpty else { return target }
+   return target.filter { $0.title.contains(keyword) }
+ }
}
```

```diff swift:SmoothieListPage
- ForEach(smoothieState.smoothies) { smoothie in
+ ForEach(
+   SmoothieListPageLogic.filter(
+     with: uiState.filterKeyword,
+     target: smoothieState.smoothies
+   )
+ ) { smoothie in
```

`filterKeyword`ã«å¤‰æ›´ãŒç™ºç”Ÿã—ãŸå ´åˆã€é–¢é€£ã™ã‚‹ç®‡æ‰€ãŒå†æ§‹ç¯‰ã•ã‚Œã‚‹ãŸã‚ã€`SmoothieListPageLogic.filter`ãŒè©•ä¾¡ã•ã‚ŒæœŸå¾…é€šã‚Šã®è¡¨ç¤ºã«ãªã£ã¦ã„ã¾ã™ã€‚

## ãŠæ°—ã«å…¥ã‚Š
ãŠæ°—ã«å…¥ã‚Šã®çŠ¶æ…‹ã¯ã€è¤‡æ•°ç”»é¢ã§å…±æœ‰ã•ã‚Œã‚‹ã®ã§Shared Stateã§ã‚ã‚Šã€æœ€çµ‚çš„ã«`@ObservedObject`ã‚’ä½¿ã£ã¦ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã—ãŸã„ãŸã‚`ObservableObject`ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¾ã™ã€‚

```swift:FavoriteSmoothieState
@MainActor
final class FavoriteSmoothieState: ObservableObject {
  @Published var favoriteSmoothies: Set<Smoothie> = []

  func update(_ smoothie: Smoothie) {
    if favoriteSmoothies.contains(smoothie) {
      favoriteSmoothies.remove(smoothie)
    } else {
      favoriteSmoothies.insert(smoothie)
    }
  }
}
```
`favoriteSmoothies`ãŒä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã§ã‚ã‚‹ãŸã‚ã€ã“ã“ã§ã¯`Binding`ãªã©ã§ã®å¤–éƒ¨ã‹ã‚‰ã®å¤‰æ›´ã‚’è¨±å¯ã—ã¦ã„ã¾ã™ã€‚

ãã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«`@ObservedObject`ã§ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©ã—ã€ã‚¹ãƒ¯ã‚¤ãƒ—ã§ãŠæ°—ã«å…¥ã‚Šã‚’ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
```diff swift: SmoothieListPage
struct SmoothieListPage: View {
  private struct UIState {
    var selectedSmoothie: Smoothie.ID?
    var filterKeyword: String = ""
  }

  @State private var uiState = UIState()
  @StateObject private var smoothieState: SmoothieState = .init(dataSource: .live)
+ @ObservedObject private var favoriteSmoothieState: FavoriteSmoothieState

+ init(favoriteSmoothieState: FavoriteSmoothieState) {
+   self.favoriteSmoothieState = favoriteSmoothieState
+ }
  var body: some View {
    List {
      ForEach(
        SmoothieListPageLogic.filter(
          with: uiState.filterKeyword,
          target: smoothieState.smoothies
        )
      ) { smoothie in
        NavigationLink(
          tag: smoothie.id,
          selection: $uiState.selectedSmoothie
        ) {
          Text(smoothie.title)
        } label: {
          SmoothieRow(smoothie: smoothie)
        }
+       .swipeActions(edge: .trailing) {
+         Button {
+           favoriteSmoothieState.update(smoothie)
+         } label: {
+           favoriteSmoothieState.favoriteSmoothies.contains(smoothie)
+             ? Image(systemName: "heart.slash")
+             : Image(systemName: "heart")
+         }
+         .tint(.pink)
        }
      }
    }
    .searchable(text: $uiState.filterKeyword)
    .navigationTitle("Menu")
    .task {
      await smoothieState.fetchSmoothies()
    }
  }
}
```

ã¾ãŸãŠæ°—ã«å…¥ã‚Šä¸€è¦§ãƒšãƒ¼ã‚¸ã§ã‚‚ã€ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ã‚’å‚ç…§ã—ãŸã„ãŸã‚`@ObservedObject`ã§ä¾å­˜é–¢ä¿‚ã‚’å®šç¾©ã—ã¾ã™ã€‚
```swift: FavoritesPage
struct FavoritesPage: View {
  @ObservedObject private var favoriteSmoothieState: FavoriteSmoothieState

  init(favoriteSmoothieState: FavoriteSmoothieState) {
    self.favoriteSmoothieState = favoriteSmoothieState
  }
  var body: some View {
    // çœç•¥
  }
}
```

:::message
çŠ¶æ…‹ã‚’è¤‡æ•°ç”»é¢ã§å…±æœ‰ã™ã‚‹ãŸã‚ã«ã¯ã€`@EnvironmentObject`ã‚’ä½¿ã£ã¦ã‚‚åŒæ§˜ã®æŒ™å‹•ã‚’å®Ÿç¾ã§ãã¾ã™ãŒã€
é›¢ã‚ŒãŸéšå±¤ã®`View`ä»¥å¤–ã§ã¯åŸºæœ¬çš„ã«ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã—ã‹ã™ã‚‹ã¨ä¸€å¾‹`@EnvironmentObject`ã¨ã—ã¦ã—ã¾ã£ã¦ã‚‚è‰¯ã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::

ã“ã‚Œã§ä¸€é€šã‚Šå®Ÿè£…ã¯å®Œäº†ã§ã™ã€‚

# ã¾ã¨ã‚
æœ¬è¨˜äº‹ã§ã¯çŠ¶æ…‹(Local State / Shared State)ãƒ»çŠ¶æ…‹ç®¡ç†ã«é–¢ã™ã‚‹èª¬æ˜ã‚’è¡Œã„ã€
çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã¨ã—ã¦ã€
- @State
- ObservableObject(å³å¯†ã«ã¯Combineã ãŒã€‚ã€‚)

ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã™ã‚‹æ©Ÿèƒ½ã¨ã—ã¦ã€
- @StateObject
- @ObservedObject
- @EnvironmentObject

ãŒã‚ã‚‹ã“ã¨ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚

ãã—ã¦ä¸Šè¨˜ã‚’è¸ã¾ãˆã¦ã©ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ãã‹ã‚’ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’é€šã—ã¦è¦‹ã¦ãã¾ã—ãŸã€‚

ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ãŠã‘ã‚‹ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ã€`SmoothieListPage`ã®ä¾å­˜é–¢ä¿‚ã¯æœ€çµ‚çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/0e5b84f5bbfd-20220507.png =400x)

å°ãƒ»ä¸­è¦æ¨¡ä¸”ã¤JSONè‰²ä»˜ã‘ãŒãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªãªã‚‰ã€ä»Šå›ç´¹ä»‹ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«Viewã‚’ä¸­å¿ƒã«ä¾å­˜é–¢ä¿‚ã‚’ä½œæˆã—ã¦ã„ãã‚ˆã†ãªè¨­è¨ˆã§ã‚‚å•é¡Œãªã„ã®ã‹ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

# å‚è€ƒURL
- https://developer.apple.com/videos/play/wwdc2020/10040